<html>
<head>
<script src="dist/dataparty-browser.js">

</script>
</head>

<body>


<script>

async function init(){

  config = new Dataparty.Config.MemoryConfig({
    basePath:'demo',
    cloud: {
      uri: 'http://172.16.3.1:4001'
    }
  })

  /*config = new Dataparty.Config.LocalStorageConfig({
    basePath:'demo',
    cloud: {
      uri: 'http://172.16.3.1:4001'
    }
  })*/


  const remoteIdentity = await Dataparty.Comms.RestComms.HttpGet( config.read('cloud.uri') + '/identity')

  console.log('cloud.uri -',config.read('cloud.uri'))
  console.log('\tremoteIdentity', remoteIdentity)

  let party = new Dataparty.PeerParty({
    comms: new Dataparty.Comms.WebsocketComms({
      uri:'ws://172.16.3.1:4001/ws',
      discoverRemoteIdentity: false,
      remoteIdentity: remoteIdentity,
      session: Math.random().toString(36).slice(2)
    }),
    config: config
  })

  window.party = party
  await party.start()

  await party.comms.authorized()


  timeTopic = new party.ROSLIB.Topic({
    ros : party.comms.ros,
    name : '/time',
    messageType: 'number'
  })

  timeTopic.subscribe((msg)=>{
    console.log(name, msg)
  })

}

init()


</script>

</body>

</html>
